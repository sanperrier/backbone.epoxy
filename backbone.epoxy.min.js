// Backbone.Epoxy 1.5.3
// (c) 2015 Greg MacWilliam
// Freely distributed under the MIT license
// http://epoxyjs.org

!function(a,b){"undefined"!=typeof exports?module.exports=b(require("underscore"),require("backbone")):"function"==typeof define&&define.amd?define(["underscore","backbone"],b):b(a._,a.Backbone)}(this,function(a,b){function c(a,b,c){return a._super.prototype[b].apply(a,c)}function d(b,c,e,f){for(var g in c)if(c.hasOwnProperty(g)){var h=c[g];if(b.hasComputed(g)){if(f.length&&a.contains(f,g))throw"Recursive setter: "+f.join(" > ");h=b.c()[g].set(h),h&&v(h)&&(e=d(b,h,e,f.concat(g)))}else e[g]=h}return e}function e(b,c,d,e){d=d||{},d.get&&u(d.get)&&(d._get=d.get),d.set&&u(d.set)&&(d._set=d.set),delete d.get,delete d.set,a.extend(this,d),this.model=b,this.name=c,this.deps=this.deps||[],e||this.init()}function f(b){return u(b)?b():(v(b)&&(b=a.clone(b),a.each(b,function(a,c){b[c]=f(a)})),b)}function g(a){return u(a)?{set:a}:a}function h(b){return function(){var c=arguments,d=u(b)?b:b.get,e=b.set;return function(b){return t(b)?d.apply(this,a.map(c,f)):c[0]((e?e:d).call(this,b))}}}function i(b,c,d,e,f){if(b=a.result(b,e)){if(x(b)){f=f?f+"_":"",c["$"+e]=function(){return H&&H.push([b,"change"]),b};var g=a.extend({},b.attributes,a.isFunction(b.c)?b.c():{});a.each(g,function(a,e){c[f+e]=function(a){return j(b,e,a,d)}})}else y(b)&&(c["$"+e]=function(){return H&&H.push([b,"reset add remove sort update"]),b});return b}}function j(b,c,d,e){if(H&&H.push([b,"change:"+c]),!t(d)){if(!v(d)||w(d)||a.isDate(d)){var f=d;d={},d[c]=f}return e&&e.save?b.save(d,e):b.set(d,e)}return b.get(c)}function k(a,b){if(":el"===b||":scope"===b)return a.$el;var c=a.$(b);return a.$el.is(b)&&(c=c.add(a.$el)),c}function l(b,c,d,e,f,g){try{var h=D[d]||(D[d]=new Function("$f","$c","with($f){with($c){return{"+d+"}}}")),i=h(g,e)}catch(a){throw'Error parsing bindings: "'+d+'"\n>> '+a}var j=a.map(a.union(i.events||[],["change"]),function(a){return a+".epoxy"}).join(" ");a.each(i,function(a,d){if(f.hasOwnProperty(d))b.b().push(new p(b,c,f[d],a,j,e,i));else if(!G.hasOwnProperty(d))throw'binding handler "'+d+'" is not defined.'})}function m(a,b,c){if(a&&a.hasOwnProperty(b))return t(c)?f(a[b]):a[b](c)}function n(a,b){var c=[];if(b&&a)for(var d=0,e=b.length;d<e;d++)c.push(b[d]in a?a[b[d]]():null);return c}function o(a){var b=[];for(var c in a){var d=a[c];v(d)&&(d="{"+o(d)+"}"),J.test(c)||K.test(c)||(c='"'+c+'"'),b.push(c+":"+d)}return b.join(",")}function p(b,c,d,e,g,h,i){var j=this,k=c[0].tagName.toLowerCase(),l="input"==k||"select"==k||"textarea"==k||"true"==c.prop("contenteditable")||c[0].hasAttribute("data-changable"),m=[],n=function(a){j.$el&&j.set(j.$el,f(e),a)};if(j.view=b,j.$el=c,j.evt=g,a.extend(j,d),e=j.init(j.$el,f(e),h,i)||e,H=m,n(),H=null,l&&d.get&&u(e)&&j.$el.on(g,function(a){e(j.get(j.$el,f(e),a))}),m.length)for(var o=0,p=m.length;o<p;o++)j.listenTo(m[o][0],m[o][1],n)}var q,r=b.Epoxy={},s=Array.prototype,t=a.isUndefined,u=a.isFunction,v=a.isObject,w=a.isArray,x=function(a){return a instanceof b.Model},y=function(a){return a instanceof b.Collection},z=function(){},A={mixin:function(a){a=a||{};for(var b in this.prototype)"bindings"===b&&a.bindings||this.prototype.hasOwnProperty(b)&&"constructor"!==b&&(a[b]=this.prototype[b]);return a}},B=["computeds"];r.Model=b.Model.extend({_super:b.Model,constructor:function(b,d){a.extend(this,a.pick(d||{},B)),c(this,"constructor",arguments),this.initComputeds(this.attributes,d)},getCopy:function(b){return a.clone(this.get(b))},get:function(a){return q&&q.push(["change:"+a,this]),this.hasComputed(a)?this.c()[a].get():c(this,"get",arguments)},set:function(b,e,f){var g=b;g&&!v(g)?(g={},g[b]=e):f=e,f=f||{};var h=this._setting=[];f.unset||(g=d(this,g,{},[])),delete this._setting;var i=c(this,"set",[g,f]);return f.silent||(!this.hasChanged()&&h.length&&this.trigger("change",this),a.each(h,function(a){this.trigger.apply(this,a)},this)),i},toJSON:function(b){var d=c(this,"toJSON",arguments);return b&&b.computed&&a.each(this.c(),function(a,b){d[b]=a.value}),d},destroy:function(){return this.clearComputeds(),c(this,"destroy",arguments)},c:function(){return this._c||(this._c={})},initComputeds:function(b,c){this.clearComputeds();var d=a.result(this,"computeds")||{};a.each(d,function(a,b){a._init=1,this.addComputed(b,a)},this),this.set(a.pick(b||{},a.keys(d))),a.invoke(this.c(),"init")},addComputed:function(a,b,c){this.removeComputed(a);var d=b,f=d._init;if(u(b)){var g=2;d={},d._get=b,u(c)&&(d._set=c,g++),d.deps=s.slice.call(arguments,g)}return this.c()[a]=new e(this,a,d,f),this},hasComputed:function(a){return this.c().hasOwnProperty(a)},removeComputed:function(a){return this.hasComputed(a)&&(this.c()[a].dispose(),delete this.c()[a]),this},clearComputeds:function(){for(var a in this.c())this.removeComputed(a);return this},modifyArray:function(a,b,c){var d=this.get(a);if(w(d)&&u(s[b])){var e=s.slice.call(arguments,2),f=s[b].apply(d,e);return c=c||{},c.silent||this.trigger("change:"+a+" change",this,d,c),f}return null},modifyObject:function(a,b,c,d){var e=this.get(a),f=!1;return v(e)?(d=d||{},t(c)&&e.hasOwnProperty(b)?(delete e[b],f=!0):e[b]!==c&&(e[b]=c,f=!0),f&&!d.silent&&this.trigger("change:"+a+" change",this,e,d),e):null}},A),a.extend(e.prototype,b.Events,{init:function(){var b={},c=q=[];this.get(!0),q=null,c.length&&(a.each(c,function(c){var d=c[0],e=c[1];b[d]?a.contains(b[d],e)||b[d].push(e):b[d]=[e]}),a.each(b,function(b,c){for(var d=0,e=b.length;d<e;d++)this.listenTo(b[d],c,a.bind(this.get,this,!0))},this))},val:function(a){return this.model.get(a)},get:function(b){if(b===!0&&this._get){var c=this._get.apply(this.model,a.map(this.deps,this.val,this));this.change(c)}return this.value},set:function(a){if(this._get){if(this._set)return this._set.apply(this.model,arguments);throw"Cannot set read-only computed attribute."}return this.change(a),null},change:function(b){if(!a.isEqual(b,this.value)){this.value=b;var c=["change:"+this.name,this.model,b];this.model._setting?this.model._setting.push(c):(c[0]+=" change",this.model.trigger.apply(this.model,c))}},dispose:function(){this.stopListening(),this.off(),this.model=this.value=null}});var C={optionText:"label",optionValue:"value"},D={},E={attr:g(function(a,b){a.attr(b)}),checked:g({get:function(b,c,d){if(b.length>1&&(b=b.filter(d.target)),b.length){var e=!!b.prop("checked"),f=b.val();if(this.isRadio(b))return f;if(w(c)){c=c.slice();var g=a.indexOf(c,f);return e&&g<0?c.push(f):!e&&g>-1&&c.splice(g,1),c}return e}},set:function(b,c){if(b.length>1&&(b=b.filter('[value="'+c+'"]')),b.length){var d=!!c;this.isRadio(b)?d=c==b.val():w(c)&&(d=a.contains(c,b.val())),b.prop("checked",d)}},isRadio:function(a){return"radio"===a.attr("type").toLowerCase()}}),classes:g(function(b,c){a.each(c,function(a,c){b.toggleClass(c,!!a)})}),collection:g({init:function(a,b,c,d){if(this.i=d.itemView?this.view[d.itemView]:this.view.itemView,!y(b))throw'Binding "collection" requires a Collection.';if(!u(this.i))throw'Binding "collection" requires an itemView.';this.v={}},set:function(b,c,d){var e,f=this.v,g=this.i,h=c.models,i=H;if(H=null,d=d||c,x(d))if(f.hasOwnProperty(d.cid))f[d.cid].remove(),delete f[d.cid];else{f[d.cid]=e=new g({model:d,collectionView:this.view});var j=a.indexOf(h,d),k=b.children();j<k.length?k.eq(j).before(e.$el):b.append(e.$el)}else if(y(d)){var l=h.length===a.size(f)&&c.every(function(a){return f.hasOwnProperty(a.cid)});b.children().detach();var m=document.createDocumentFragment();l?c.each(function(a){m.appendChild(f[a.cid].el)}):(this.clean(),c.each(function(a){f[a.cid]=e=new g({model:a,collectionView:this.view}),m.appendChild(e.el)},this)),b.append(m)}H=i},clean:function(){for(var a in this.v)this.v.hasOwnProperty(a)&&(this.v[a].remove(),delete this.v[a])}}),css:g(function(a,b){a.css(b)}),disabled:g(function(a,b){a.prop("disabled",!!b)}),enabled:g(function(a,b){a.prop("disabled",!b)}),html:g(function(a,b){a.html(b)}),options:g({init:function(a,b,c,d){this.e=d.optionsEmpty,this.d=d.optionsDefault,this.v=d.value},set:function(b,c){var d=this,e=f(d.e),g=f(d.d),h=f(d.v),i=y(c)?c.models:c,j=i.length,k=!0,l="";j||g||!e?(g&&(i=[g].concat(i)),a.each(i,function(a,b){l+=d.opt(a,j)})):(l+=d.opt(e,j),k=!1),b.html(l).prop("disabled",!k).val(h),b[0].selectedIndex<0&&b.children().length&&(b[0].selectedIndex=0);var m=b.val();d.v&&!a.isEqual(h,m)&&d.v(m)},opt:function(a,b){var c=a,d=a,e=C.optionText,f=C.optionValue;return v(a)&&(c=x(a)?a.get(e):a[e],d=x(a)?a.get(f):a[f]),['<option value="',d,'">',c,"</option>"].join("")},clean:function(){this.d=this.e=this.v=0}}),template:g({init:function(b,c,d){var e=b.find("script,template");if(this.t=a.template(e.length?e.html():b.html()),w(c))return a.pick(d,c)},set:function(a,b){b=x(b)?b.toJSON({computed:!0}):b,a.html(this.t(b))},clean:function(){this.t=null}}),text:g({get:function(a){return a.text()},set:function(a,b){a.text(b)}}),toggle:g(function(a,b){a.toggle(!!b)}),value:g({get:function(a){return a.val()},set:function(a,b){try{a.val()+""!=b+""&&a.val(b)}catch(a){}}})},F={all:h(function(){for(var a=arguments,b=0,c=a.length;b<c;b++)if(!a[b])return!1;return!0}),any:h(function(){for(var a=arguments,b=0,c=a.length;b<c;b++)if(a[b])return!0;return!1}),length:h(function(a){return a.length||0}),none:h(function(){for(var a=arguments,b=0,c=a.length;b<c;b++)if(a[b])return!1;return!0}),not:h(function(a){return!a}),format:h(function(a){for(var b=arguments,c=1,d=b.length;c<d;c++)a=a.replace(new RegExp("\\$"+c,"g"),b[c]);return a}),select:h(function(a,b,c){return a?b:c}),csv:h({get:function(a){return a=String(a),a?a.split(","):[]},set:function(a){return w(a)?a.join(","):a}}),integer:h(function(a){return a?parseInt(a,10):0}),decimal:h(function(a){return a?parseFloat(a):0})},G={events:1,itemView:1,optionsDefault:1,optionsEmpty:1};r.binding={allowedParams:G,addHandler:function(a,b){E[a]=g(b)},addFilter:function(a,b){F[a]=h(b)},config:function(b){a.extend(C,b)},emptyCache:function(){D={}}};var H,I=["viewModel","bindings","bindingFilters","bindingHandlers","bindingSources","computeds"];r.View=b.View.extend({_super:b.View,constructor:function(b){a.extend(this,a.pick(b||{},I)),c(this,"constructor",arguments),this.applyBindings()},b:function(){return this._b||(this._b=[])},bindings:"data-bind",setterOptions:null,applyBindings:function(){this.removeBindings();var c=this,d=a.clone(a.result(c,"bindingSources")),e=c.bindings,f=c.setterOptions,j=a.clone(E),m=a.clone(F),p=c._c={};a.each(a.result(c,"bindingHandlers")||{},function(a,b){j[b]=g(a)}),a.each(a.result(c,"bindingFilters")||{},function(a,b){m[b]=h(a)}),c.model=i(c,p,f,"model"),c.viewModel=i(c,p,f,"viewModel"),c.collection=i(c,p,f,"collection"),c.collection&&c.collection.view&&(c.itemView=c.collection.view),d&&(a.each(d,function(a,b){d[b]=i(d,p,f,b,b)}),c.bindingSources=d),a.each(a.result(c,"computeds")||{},function(a,b){var d=u(a)?a:a.get,e=a.set,f=a.deps;p[b]=function(a){return!t(a)&&e?e.call(c,a):d.apply(c,n(c._c,f))}}),v(e)?a.each(e,function(a,b){var d=k(c,b);v(a)&&(a=o(a)),d.length&&l(c,d,a,p,j,m)}):k(c,"["+e+"]").each(function(){var a=b.$(this);l(c,a,a.attr(e),p,j,m)})},getBinding:function(a){return m(this._c,a)},setBinding:function(a,b){return m(this._c,a,b)},removeBindings:function(){if(this._c=null,this._b)for(;this._b.length;)this._b.pop().dispose()},remove:function(){this.removeBindings(),c(this,"remove",arguments)}},A);var J=/^[a-z_$][a-z0-9_$]*$/i,K=/^\s*(["']).*\1\s*$/;return a.extend(p.prototype,b.Events,{init:z,get:z,set:z,clean:z,dispose:function(){this.clean(),this.stopListening(),this.$el.off(this.evt),this.$el=this.view=null}}),r});
//# sourceMappingURL=backbone.epoxy.min.map